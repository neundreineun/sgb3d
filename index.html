<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <title>Siegburg BrÃ¼ckberg 3D</title>
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.110/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.110/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    <style>
        body { margin: 0; padding: 0; background: #000; overflow: hidden; font-family: sans-serif; }
        #cesiumContainer { width: 100%; height: 100vh; }
        #ui-panel { position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.85); color: #00ffcc; padding: 15px; border-radius: 10px; border: 1px solid #00ffcc; z-index: 100; width: 260px; }
        .btn-rain { width: 100%; background: #0077ff; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; margin-top: 10px; }
        #loader { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); border: 4px solid #333; border-top: 4px solid #00ffcc; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; z-index: 1000; }
        @keyframes spin { 100% { transform: translate(-50%, -50%) rotate(360deg); } }
    </style>
</head>
<body>
    <div id="loader"></div>
    <div id="ui-panel">
        <h3 style="margin:0;">BRÃœCKBERG HD</h3>
        <p style="font-size:0.8em; color:#888;">LIDAR Precision: 0.25m</p>
        <hr style="border:0.5px solid #333;">
        <label><input type="checkbox" id="l-dop" checked> Luftbild HD</label><br>
        <label><input type="checkbox" id="l-trees" checked> Wald-Modell</label>
        <button class="btn-rain" onclick="startRain()">ðŸŒ§ Regen-Simulation</button>
        <div id="info" style="margin-top:10px; font-size:0.8em;">Klicke GelÃ¤nde...</div>
    </div>
    <div id="cesiumContainer"></div>
<script>
    Cesium.Ion.defaultAccessToken = 'DEIN_CESIUM_ION_TOKEN'; // <--- TOKEN HIER REIN!
    const viewer = new Cesium.Viewer('cesiumContainer', { terrainProvider: Cesium.createWorldTerrain(), baseLayerPicker: false, infoBox: false });
    const dop = viewer.imageryLayers.addImageryProvider(new Cesium.WebMapServiceImageryProvider({ url: 'https://www.wms.nrw.de/geobasis/wms_nw_dop', layers: 'nw_dop_rgb' }));
    const trees = viewer.scene.primitives.add(new Cesium.BillboardCollection());
    for(let i=0; i<150; i++) { trees.add({ position: Cesium.Cartesian3.fromDegrees(7.234 + Math.random()*0.005, 50.801 + Math.random()*0.005), image: 'https://img.icons8.com/color/48/tree.png', verticalOrigin: Cesium.VerticalOrigin.BOTTOM, distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0, 3000) }); }
    const drops = viewer.scene.primitives.add(new Cesium.PointPrimitiveCollection());
    function startRain() { for(let i=0; i<100; i++) { const p = drops.add({ position: Cesium.Cartesian3.fromDegrees(7.235, 50.803, 180), color: Cesium.Color.CYAN, pixelSize: 3 }); animateDrop(p); } }
    function animateDrop(p) { let pos = Cesium.Cartographic.fromCartesian(p.position); let int = setInterval(() => { pos.latitude -= 0.000005; pos.longitude += 0.000002; p.position = Cesium.Cartesian3.fromRadians(pos.longitude, pos.latitude, pos.height); }, 30); setTimeout(() => { clearInterval(int); drops.remove(p); }, 4000); }
    document.getElementById('l-dop').onchange = (e) => dop.show = e.target.checked;
    document.getElementById('l-trees').onchange = (e) => trees.show = e.target.checked;
    viewer.scene.globe.tileLoadProgressEvent.addEventListener((q) => { if(q === 0) document.getElementById('loader').style.display='none'; });
    viewer.camera.flyTo({ destination: Cesium.Cartesian3.fromDegrees(7.234, 50.801, 800), orientation: { pitch: Cesium.Math.toRadians(-30) } });
</script>
</body>
</html>